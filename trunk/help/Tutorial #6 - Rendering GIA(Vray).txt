1. Required Tools
=================
- 3DS Max
- VRay(Student version is about 100 USD, or get the Yarr version)


2. Preparations
===============

- GIA Rendering is quite an expensive process, which needs a lot of patience. You'll need to be sure to set this up well if you want good results ingame, and if you followed the modelling guidelines properly, you won't have much trouble with it.

- Generations uses two types of maps for GIA. The regular lightmap, which is the information of the coloring on the object affected by light, and a shadowmap, which marks what areas of the object are shadowed or not. Generations uses a single texture for this, but sadly, VRay can't render appropiate maps like it.

For the sake of doing this, I've provided a utility in the tools folder called "gia-merger", which will allow you to merge both maps generated by VRay into single GIA maps that are ready to be used by Generations.


- The only way to render both a lightmap and a shadowmap will be by rendering it twice. Luckily, the shadowmap rendering will be incredibly more lightweight. You should set up your VRay renderer and save the presets for when you're ready. Using presets will help you switch faster between both working settings.

* LIGHTMAP RENDERING: This is the information as if the whole map was "shadowed", and it will also have the light reflection/coloring information the engine needs. Compare "tutorial_example_full.png" and "tutorial_example_lightmap.png"... The easiest way to reach the results of the 2nd render is by disabling lights altogether. Make sure you enable some nice settings like an HDRI enviroment map, or GI and such... it will increase rendering time, but it will make your scene look much better. Do consider sacrificing some quality on the passes for the sake of rendering faster tho.

* SHADOWMAP RENDERING: This one's a bit more complicated to achieve correctly, but it is really lightweight to render. Disable most special effects you have, even maps as well(so they don't show up as textured), displacement effects, everything but lights and shadows. You can play with the color mapping to a ridiculously dark and bright multiplier(-5.0 for dark, 5.0 for bright). You should get some similar results to "tutorial_example_shadowmap.png", which will mark pretty strongly which parts are shadowed and which are lit. This will merely act as an Alpha channel later on.


3. Rendering
============

There's a maxscript provided for doing the Lightmap rendering. First, you need to select the objects which you will render. Then go to the Maxscript menu, select run, and select "GenerateLightmaps.ms" over at the export_scripts/3dsmax folder. It will prompt you some settings for Max resolution, and whether to use a multiplier or not. The multiplier is a value for adaptive scaling of the map to the object size. This is very, VERY useful, as you do not want a little rock to have a GIA map of the size of a mountain; it's a waste of resources.

I'd recommend you to play around with a small test area and the multiplier until you find a value you're happy with.

You might've noticed the appendix option. This one controls what's appended to the end of your filename, so select what matches depending on your rendering settings. Once done, you can start with the lightmap generation.

You'll have to do this process twice with the lightmap rendering settings, and then with the shadowmap rendering settings. Keep a note of where you're saving your files to, and then proceed to section #4.

IMPORTANT: Rendering unwraps the UV coordinates of these maps to the 2nd channel of your objects, so once you're done, SAVE YOUR MAX SCENE, and RE-EXPORT YOUR OGRE SCENE to be used in SonicGLvl. Otherwise your GIA won't be mapped to your meshes!



4. Merging both maps
====================

Check out the readme.txt in the "tools\gia-merger" folder for instructions on how to use it to merge your lightmaps.

Basically, all you need to do is dump the rendered files into the source folder, run the exe, and take out of the output folder your new GIA maps. You can then copy these into your exported scene folder, and the editor will pick them up and copy them when importing your scene next time.


5. Making GIA work in the editor
================================

You don't need to do anything special for GIA to work in the editor. When importing your scene, simply generate your terrain groups as usual. When that step is done, your GIA textures will be generated for different levels of quality. when repacking your stage, it will copy them to the appropiate sub-folders and include them in your Stage.pfd.








